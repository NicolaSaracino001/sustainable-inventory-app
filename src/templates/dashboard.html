{% extends "base.html" %}

{% block title %}Dashboard - S.I.M.{% endblock %}

{% block content %}
    <h2>Dashboard Prodotti</h2>
    
    <table border="1" width="100%">
        <thead>
            <tr>
                <th>Nome Prodotto</th>
                <th>Quantità</th>
                <th>Costo/Unità</th>
                <th>Data Scadenza</th>
                <th>Azione</th> </tr>
        </thead>
        <tbody>
            {% for product in products %}
            
            {% set days_left = (product.expiry_date.date() - today).days %}
            
            {% if days_left < 0 %}
                <tr class="tr-expired">
            {% elif days_left <= 7 %}
                <tr class="tr-danger">
            {% elif days_left <= 30 %}
                <tr class="tr-warning">
            {% else %}
                <tr> {% endif %}
            
                <td>{{ product.name }}</td>
                <td>{{ product.quantity }}</td>
                <td>€ {{ "%.2f"|format(product.cost_per_unit) if product.cost_per_unit else 'N/A' }}</td>
                <td>{{ product.expiry_date.strftime('%Y-%m-%d') }}</td>
                
                <td>
                    <a href="{{ url_for('inventory_bp.delete_product', product_id=product.id) }}" 
                       onclick="return confirm('Sei sicuro di voler eliminare questo prodotto?');">
                       Elimina
                    </a>
                </td>
            
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if not products %}
        <p>Nessun prodotto nell'inventario. Aggiungine uno!</p>
    {% endif %}
    
{% endblock %}